
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:int="http://www.springframework.org/schema/integration"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">

<bean id="azureHotFolderBlobSessionVendorAcme" class="de.hybris.platform.cloud.azure.hotfolder.remote.session.AzureBlobSession">
    <constructor-arg ref="azureHotFolderBlobClient"/>
    <constructor-arg value="${azure.hotfolder.storage.container.acme.name}"/>
    <constructor-arg value="${azure.hotfolder.storage.container.create}"/>
</bean>

<bean id="azureBlobSessionFactoryVendorAcme" class="de.hybris.platform.cloud.azure.hotfolder.remote.session.AzureBlobSessionFactory">
<constructor-arg ref="azureHotFolderBlobSessionVendorAcme"/>
</bean>

<bean id="azureBlobInboundSynchronizerVendorAcme" class="de.hybris.platform.cloud.azure.hotfolder.remote.synchronizer.AzureBlobInboundSynchronizer">
<constructor-arg ref="azureBlobSessionFactoryVendorAcme"/>
<property name="deleteRemoteFiles" value="${azure.hotfolder.storage.delete.remote.files}"/>
<property name="remoteDirectory" value="#{azureHotfolderRemotePath}"/>
<property name="filter" ref="azureChainFileListFilter"/>
<property name="preserveTimestamp" value="true"/>
</bean>

<bean id="azureBlobSynchronizingMessageSourceVendorAcme"
      class="de.hybris.platform.cloud.azure.hotfolder.remote.synchronizer.AzureBlobSynchronizingMessageSource">
<constructor-arg ref="azureBlobInboundSynchronizerVendorAcme"/>
<constructor-arg ref="cloudHotFolderFileComparator"/>
<property name="autoCreateLocalDirectory" value="true"/>
<property name="localFilter">
    <bean class="org.springframework.integration.file.filters.AcceptAllFileListFilter"/>
</property>
<property name="localDirectory" value="#{azureHotfolderLocalDirectoryBase}/#{azureHotfolderRemotePath}"/>
</bean>

<int:inbound-channel-adapter id="azureInboundChannelAdapterVendorAcme"
                             auto-startup="false"
                             role="${cloud.hotfolder.storage.services.role}"
                             phase="50"
                             ref="azureBlobSynchronizingMessageSourceVendorAcme"
                             channel="hotfolderInboundFileHeaderEnricherChannel">
<int:poller fixed-rate="${azure.hotfolder.storage.polling.fixed.rate}" task-executor="hybrisIntegrationTaskExecutor"/>
</int:inbound-channel-adapter>

<bean id="blobTransferredAspect" class="de.hybris.platform.cloud.azure.hotfolder.aop.BlobTransferredAspect" parent="abstractMonitoringAspect"/>

<aop:config>
<aop:aspect ref="blobTransferredAspect">
    <aop:around method="aroundRead" pointcut="bean(azureHotFolderBlobSession) and execution(* read(..)) and args(path,..)"/>
</aop:aspect>
</aop:config>

</beans>